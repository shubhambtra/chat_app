<!-- <!DOCTYPE html>
<html>
<head>
    <title>Sales Coach System</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 h-screen flex">

 
<div class="w-1/3 bg-white p-4 border-r">
    <h2 class="text-xl font-bold mb-3">AI Sales Coach</h2>

    <label class="font-semibold">Suggested Reply</label>
    <textarea id="suggested"
              class="w-full border p-2 mb-3"
              rows="4"></textarea>

    <p><strong>Interest Level:</strong> <span id="interest"></span></p>
    <p><strong>Conviction %:</strong> <span id="conversion"></span></p>
    <p><strong>Objection:</strong> <span id="objection"></span></p>
    <p><strong>Next Action:</strong> <span id="next"></span></p>
</div>

 
<div class="flex-1 flex flex-col">
    <div id="chatBox" class="flex-1 p-4 overflow-y-auto"></div>

    <div class="p-4 bg-white">
        <input id="customerInput"
               class="w-full border px-3 py-2 mb-2"
               placeholder="Customer message..." />

        <button onclick="customerSend()"
                class="bg-gray-600 text-white px-4 py-2 rounded">
            Customer Send
        </button>

        <hr class="my-3">

        <input id="salesReply"
               class="w-full border px-3 py-2 mb-2"
               placeholder="Sales reply to customer..." />

        <button onclick="salesSend()"
                class="bg-blue-500 text-white px-4 py-2 rounded">
            Sales Send
        </button>
    </div>
</div>

<script>
function customerSend() {
    const input = document.getElementById("customerInput");
    const message = input.value;
    if (!message) return;

    addMessage("Customer", message);
    input.value = "";

    fetch("/analyze", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message: message })
    })
    .then(res => res.json())
    .then(data => {
        document.getElementById("suggested").value = data.suggested_reply;
        document.getElementById("interest").innerText = data.interest_level;
        document.getElementById("conversion").innerText = data.conversion_percentage + "%";
        document.getElementById("objection").innerText = data.objection;
        document.getElementById("next").innerText = data.next_action;

        document.getElementById("salesReply").value = data.suggested_reply;
    });
}

function salesSend() {
    const reply = document.getElementById("salesReply").value;
    if (!reply) return;

    addMessage("Sales", reply);
    document.getElementById("salesReply").value = "";
}

function addMessage(sender, text) {
    const box = document.getElementById("chatBox");
    box.innerHTML += `<div class="mb-2"><strong>${sender}:</strong> ${text}</div>`;
    box.scrollTop = box.scrollHeight;
}
</script>

</body>
</html> -->
<!DOCTYPE html>
<html>
<head>
    <title>Customer Chat</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 h-screen flex flex-col">

<h2 class="text-center font-bold p-3 bg-white shadow">
    Customer Support Chat
</h2>

<!-- CHAT AREA (ONLY SALES MESSAGES) -->
<div id="chatBox" class="flex-1 p-4 overflow-y-auto"></div>

<!-- CUSTOMER INPUT -->
<div class="p-4 bg-white flex">
    <input id="msg"
           class="flex-1 border p-2 rounded-l"
           placeholder="Type your message..." />
    <button onclick="send()"
            class="bg-blue-500 text-white px-4 rounded-r">
        Send
    </button>
</div>

<script>
function load() {
    fetch("/messages")
    .then(r => r.json())
    .then(data => {
        chatBox.innerHTML = "";

        // âœ… SHOW ONLY SALES MESSAGES
        data.forEach(m => {
            if (m.sender === "Sales") {
                chatBox.innerHTML += `
                  <div class="mb-2">
                    <b>Support:</b> ${m.text}
                  </div>`;
            }
        });
    });
}

function send() {
    const text = msg.value;
    if (!text) return;

    fetch("/send_customer", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ message: text })
    }).then(() => {
        msg.value = "";
    });
}

// Refresh chat every 2 seconds
setInterval(load, 2000);
load();
</script>

</body>
</html>
    